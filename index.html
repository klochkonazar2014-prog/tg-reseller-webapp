<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MRKT</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="lottie.min.js"></script>
    <link rel="stylesheet" href="style.css?v=1.1.80">
</head>

<body>
    <!-- Full Screen Product View -->
    <div id="product-view" class="product-view">
        <div class="product-view-header"
            style="background: rgba(15, 21, 28, 0.95); display: flex; align-items: center; justify-content: space-between; padding: 12px 16px;">
            <button class="back-btn" onclick="closeProductView()" style="background:none; border:none; color:#fff;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
            </button>
            <div style="display: flex; gap: 15px; color: #8b9bb4;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                    <polyline points="16 6 12 2 8 6"></polyline>
                    <line x1="12" y1="2" x2="12" y2="15"></line>
                </svg>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
            </div>
        </div>

        <div class="product-main-media" style="position: relative;">
            <img id="view-img" src="" alt="NFT">
            <div id="view-lottie"
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div>
        </div>

        <div class="product-info-section">
            <div class="product-title-row">
                <h1 id="view-title">Name #000</h1>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
            </div>

            <div id="view-collection" class="product-collection-link">Collection ></div>

            <div class="badge-row">
                <div class="market-badge badge-rent">В аренде</div>
                <div class="market-badge badge-app">Marketapp</div>
            </div>

            <div class="pricing-card"
                style="background: rgba(33, 42, 51, 0.4); border-radius: 12px; padding: 16px; margin: 16px 0;">
                <div class="pricing-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                    <div>
                        <div class="pricing-label"
                            style="font-size: 11px; color:#8794a1; font-weight:600; margin-bottom:4px;">Price per day
                        </div>
                        <div class="pricing-value">
                            <div id="view-daily-price" style="font-size: 16px; font-weight:700; color:#fff;">▼ 0.01
                            </div>
                            <div id="view-daily-price-usd" style="font-size: 11px; color:#8794a1; margin-top:2px;">
                                ~$0.00</div>
                        </div>
                    </div>
                    <div>
                        <div class="pricing-label"
                            style="font-size: 11px; color:#8794a1; font-weight:600; margin-bottom:4px;">Period (Days)
                        </div>
                        <div id="view-duration-range" class="pricing-value"
                            style="font-size: 16px; font-weight:700; color:#fff;">1 — 34</div>
                    </div>
                    <div>
                        <div class="pricing-label"
                            style="font-size: 11px; color:#8794a1; font-weight:600; margin-bottom:4px;">Discount</div>
                        <div id="view-discount" class="pricing-value"
                            style="font-size: 16px; font-weight:700; color:#fff;">0.1%</div>
                    </div>
                </div>
                <div class="auto-relist-note"
                    style="margin-top: 12px; display: flex; gap: 8px; font-size: 11px; color: #8794a1;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                    </svg>
                    <span>Auto re-list. This NFT will be available for rent automatically after the period ends.</span>
                </div>
            </div>

            <div class="rent-action-row" style="display: flex; gap: 12px; margin-top: 16px;">
                <div class="rent-period-stepper"
                    style="display: flex; background: #242e38; border-radius: 8px; height: 48px; flex: 0.4; overflow: hidden;">
                    <button class="step-minus" onclick="adjustDuration(-1)"
                        style="flex:1; border:none; background:none; color:#8b9bb4; font-size:24px;">−</button>
                    <input type="number" id="rent-duration-input" value="1" readonly
                        style="width:40px; background:none; border:none; color:#fff; text-align:center; font-weight:700; font-size:15px; pointer-events:none;">
                    <button class="step-plus" onclick="adjustDuration(1)"
                        style="flex:1; border:none; background:none; color:#8b9bb4; font-size:24px;">+</button>
                </div>
                <button id="confirm-pay-btn" class="main-rent-btn"
                    style="flex: 1; background: #0a58ca; border:none; border-radius:8px; height:48px; color:#fff; font-weight:700; font-size:13px; display:none;">Rent
                    for ▼ 0.01</button>
                <div id="ton-connect-btn" class="ton-btn-wrapper" style="flex: 1;"></div>
            </div>

            <div class="fee-info-card"
                style="background: rgba(33, 42, 51, 0.4); border: 1px solid rgba(0, 136, 204, 0.2); padding: 12px; border-radius: 12px; margin-top: 12px; font-size: 13px; line-height: 1.4; color: #8794a1;">
                You will additionally send 0.2 TON for transaction processing. Excess TON will be returned to you.
                <span style="color:var(--accent-blue); cursor:pointer;">What does it mean?</span>
            </div>

            <div class="listing-info-card"
                style="background: rgba(33, 42, 51, 0.4); border: 1px solid rgba(255, 165, 0, 0.2); padding: 12px; border-radius: 12px; margin-top: 12px; font-size: 13px; color: #fff;">
                <div style="font-weight:700;">This gift was listed for rent less than 24 hours ago.</div>
                <div style="color:#8794a1; margin-top:4px;">Listed at: 1 minute ago <span
                        style="color:var(--accent-blue); cursor:pointer;">What does it mean?</span></div>
            </div>

            <div class="secondary-actions" style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="sec-btn"
                    style="flex:1; background: #212a33; border:none; height:48px; border-radius:12px; color:#fff; font-weight:600; font-size:14px; display:flex; align-items:center; justify-content:center; gap:8px;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                        <line x1="7" y1="7" x2="7.01" y2="7"></line>
                    </svg>
                    Make Offer
                </button>
                <button class="sec-btn"
                    style="flex:1; background: #212a33; border:none; height:48px; border-radius:12px; color:#fff; font-weight:600; font-size:14px; display:flex; align-items:center; justify-content:center; gap:8px;">
                    Create Deal <span
                        style="background:var(--accent-blue); font-size:10px; padding:2px 6px; border-radius:4px; margin-left:4px;">New</span>
                </button>
            </div>

            <div class="owner-col-section"
                style="margin-top: 24px; background: rgba(33, 42, 51, 0.4); border-radius: 12px; overflow: hidden;">
                <div class="detail-row"
                    style="padding: 14px 16px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #fff; font-weight: 700; font-size: 13px;">Owner</span>
                    <span id="view-owner" style="color: var(--accent-blue); font-size: 13px;">fragment.ton ></span>
                </div>
                <div class="detail-row"
                    style="padding: 14px 16px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #fff; font-weight: 700; font-size: 13px;">Collection</span>
                    <span id="view-col-name" style="color: var(--accent-blue); font-size: 13px;">Joyful Bundles ></span>
                </div>
                <div class="detail-row"
                    style="padding: 14px 16px; display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #fff; font-weight: 700; font-size: 13px;">NFT address</span>
                    <span id="view-address"
                        style="color: var(--accent-blue); font-size: 13px; display:flex; align-items:center; gap:6px;">EQAmL...SEv
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg></span>
                </div>
            </div>

            <div class="properties-tabs"
                style="margin-top: 24px; border-bottom: 2px solid rgba(255,255,255,0.05); display: flex; gap: 20px;">
                <div class="tab-item active"
                    style="color: #fff; font-weight: 700; font-size: 14px; padding-bottom: 8px; border-bottom: 2px solid var(--accent-blue); cursor: pointer;">
                    Details</div>
                <div class="tab-item"
                    style="color: var(--text-secondary); font-weight: 600; font-size: 14px; padding-bottom: 8px; cursor: pointer;">
                    Deal Info</div>
            </div>

            <div id="view-properties" style="margin-top: 16px; margin-bottom: 40px;">
                <!-- Dynamic props here -->
            </div>

        </div>
    </div>

    <!-- Premium Loading Screen -->
    <div id="loading-screen">
        <div class="premium-spinner"></div>
        <div style="color: #fff; font-weight: 600; letter-spacing: 1px;">ARENDA</div>
    </div>

    <!-- Header MRKT -->
    <div class="header-column">
        <!-- Search -->
        <div class="search-row">
            <div class="search-wrapper">
                <svg style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #8b9bb4;"
                    width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" id="search-input" class="search-bar" placeholder="Поиск по названию NFT / номеру">
            </div>
            <button class="header-cart-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <path d="M16 10a4 4 0 0 1-8 0"></path>
                </svg>
            </button>
        </div>

        <!-- Chips -->
        <div class="chips-row">
            <button class="chip-btn icon-only" onclick="openAdvancedFilters()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M4 21v-7m0-4V3m8 18v-9m0-4V3m8 18v-5m0-4V3M1 14h6m2-6h6m2 8h6"></path>
                </svg>
            </button>

            <button class="chip-btn" onclick="toggleGenericModal('nft')">
                NFT <span>▼</span>
            </button>

            <button class="chip-btn" onclick="toggleGenericModal('model')">
                Модель <span>▼</span>
            </button>

            <button class="chip-btn" onclick="toggleGenericModal('bg')">
                Фон <span>▼</span>
            </button>

            <button class="chip-btn" onclick="toggleGenericModal('symbol')">
                Символ <span>▼</span>
            </button>
        </div>

        <input type="hidden" id="filter-nft" value="all">
        <input type="hidden" id="filter-sort" value="price_asc">
    </div>

    <!-- Filter Modal (Advanced) -->
    <div id="mrkt-modal-overlay" class="modal-overlay" onclick="closeMrktModal()"></div>
    <div id="mrkt-modal" class="filter-panel">
        <div class="mrkt-modal-header">
            <h3>Фильтры</h3>
            <button onclick="closeMrktModal()"
                style="background:none; border:none; color:#8b9bb4; font-size:24px; cursor: pointer;">✕</button>
        </div>

        <div class="filter-content">
            <!-- Gift Number Section -->
            <div class="filter-section-title">Номер подарка</div>
            <div class="filter-input-row">
                <div class="filter-input-wrapper">
                    <span>#</span>
                    <input type="number" id="filter-gift-number" placeholder="Номер">
                </div>
            </div>

            <!-- Sort Section -->
            <div class="filter-accordion" onclick="toggleAccordion('sort-acc', this)">
                <span>Сортировать по</span>
                <div class="filter-accordion-arrow">▼</div>
            </div>
            <div id="sort-acc" class="accordion-content">
                <div id="sort-list-container" style="padding: 0 20px;"></div>
            </div>

            <!-- Price Section -->
            <div class="filter-accordion" onclick="toggleAccordion('price-acc', this)">
                <span>Цена</span>
                <div class="filter-accordion-arrow">▼</div>
            </div>
            <div id="price-acc" class="accordion-content">
                <div class="filter-input-row" style="padding-top:10px;">
                    <div class="filter-input-wrapper">
                        <span>▼</span>
                        <input type="number" id="filter-price-from" placeholder="От">
                    </div>
                    <div style="color:#555">—</div>
                    <div class="filter-input-wrapper">
                        <input type="number" id="filter-price-to" placeholder="До">
                    </div>
                </div>
            </div>

            <!-- Categories -->
            <div class="filter-accordion" onclick="toggleAccordion('tags-acc', this)">
                <span>Теги</span>
                <div class="filter-accordion-arrow">▼</div>
            </div>
            <div id="tags-acc" class="accordion-content">
                <div id="tags-list-container" style="padding: 0 20px;"></div>
            </div>

            <div class="filter-accordion" onclick="toggleAccordion('nft-acc', this)">
                <span>NFT</span>
                <div class="filter-accordion-arrow">▼</div>
            </div>
            <div id="nft-acc" class="accordion-content">
                <div id="nft-list-container" style="padding: 0 20px;"></div>
            </div>

            <div class="filter-accordion" onclick="toggleAccordion('model-acc', this)">
                <span>Модель</span>
                <div class="filter-accordion-arrow">▼</div>
            </div>
            <div id="model-acc" class="accordion-content">
                <div id="model-list-container" style="padding: 0 20px;"></div>
            </div>

            <div class="filter-accordion" onclick="toggleAccordion('bg-acc', this)">
                <span>Фон</span>
                <div class="filter-accordion-arrow">▼</div>
            </div>
            <div id="bg-acc" class="accordion-content">
                <div id="bg-list-container" style="padding: 0 20px;"></div>
            </div>

            <div class="filter-accordion" onclick="toggleAccordion('symbol-acc', this)">
                <span>Символ</span>
                <div class="filter-accordion-arrow">▼</div>
            </div>
            <div id="symbol-acc" class="accordion-content">
                <div id="symbol-list-container" style="padding: 0 20px;"></div>
            </div>
        </div>

        <div class="mrkt-footer">
            <button class="btn-gray" onclick="resetMrktModal()">Очистить все</button>
            <button class="btn-yellow" onclick="applyMrktModal()">Показать результаты</button>
        </div>
    </div>

    <!-- Content -->
    <div class="container">
        <!-- Market Tab -->
        <div id="market-container">
            <div id="top-loader" class="loader">Загрузка данных рынка...</div>
            <div id="items-view" class="grid"></div>
            <div id="loader-trigger" style="height: 40px;"></div>
        </div>

        <!-- Orders Tab -->
        <div id="orders-container" style="display: none; padding: 20px; text-align: center; color: #8b9bb4;">
            <h3>Ваши ордеры</h3>
            <p style="margin-top: 10px; font-size: 14px;">У вас пока нет активных аренд.</p>
        </div>

        <!-- Hub Tab -->
        <div id="hub-container" style="display: none; padding: 20px; text-align: center; color: #8b9bb4;">
            <h3>Игровой хаб</h3>
            <p style="margin-top: 10px; font-size: 14px;">Скоро здесь появятся игры!</p>
        </div>

        <!-- Raffle Tab -->
        <div id="raffle-container" style="display: none; padding: 20px; text-align: center; color: #8b9bb4;">
            <h3>Розыгрыши</h3>
            <p style="margin-top: 10px; font-size: 14px;">Активных розыгрышей нет.</p>
        </div>

        <!-- Storage Tab -->
        <div id="storage-container" style="display: none; padding: 20px; text-align: center; color: #8b9bb4;">
            <h3>Хранилище</h3>
            <p style="margin-top: 10px; font-size: 14px;">Ваше хранилище пусто.</p>
        </div>
    </div>

    <!-- Bottom Nav -->
    <div class="bottom-nav">
        <div class="nav-item active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg>
            <span>Маркет</span>
        </div>
        <div class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M9 11l3 3L22 4"></path>
                <path d="M22 12v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h9"></path>
            </svg>
            <span>Ордеры</span>
        </div>
        <div class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <rect x="2" y="6" width="20" height="12" rx="2"></rect>
                <path d="M6 12h.01"></path>
                <path d="M10 12h.01"></path>
                <path d="M15 10l2 2-2 2"></path>
                <path d="M19 12h.01"></path>
            </svg>
            <span>Игровой хаб</span>
        </div>
        <div class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 8v8"></path>
                <path d="M8 12h8"></path>
            </svg>
            <span>Розыгрыши</span>
        </div>
        <div class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
            <span>Хранилище</span>
        </div>
    </div>

    <script src="app.js?v=1.1.106"></script>
</body>

</html>